<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Moderation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            color: #333;
        }
        .file-item {
            margin-bottom: 15px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .file-info {
            flex-grow: 1;
            margin-right: 10px;
        }
        .file-actions button {
            margin-left: 5px;
        }
    </style>
</head>
<body>
    <h1>Pending Music Moderation</h1>
    <ul id="pending-list"></ul>

    <script>
        // Fetch pending files
        fetch('http://127.0.0.1:8443/music/pending')
            .then(response => {
                if (!response.ok) throw new Error('Failed to fetch pending files.');
                return response.json();
            })
            .then(data => {
                const pendingList = document.getElementById('pending-list');
                data.forEach(file => {
                    // Create list item
                    const listItem = document.createElement('li');
                    listItem.className = 'file-item';

                    // File information
                    const fileInfo = document.createElement('div');
                    fileInfo.className = 'file-info';
                    fileInfo.textContent = file; // Display file name

                    // Action buttons
                    const actions = document.createElement('div');
                    actions.className = 'file-actions';

                    const playButton = document.createElement('button');
                    playButton.textContent = 'Play';
                    playButton.onclick = () => {
                        const fileId = file.match(/\(ID: (.+)\)$/)[1];
                        const audioPlayer = new Audio(`http://127.0.0.1:8080/music/stream?fileId=${fileId}`);
                        audioPlayer.play();
                    };

                    const approveButton = document.createElement('button');
                    approveButton.textContent = 'Approve';
                    approveButton.onclick = () => moderateFile(file, true);

                    const rejectButton = document.createElement('button');
                    rejectButton.textContent = 'Reject';
                    rejectButton.onclick = () => moderateFile(file, false);

                    // Append buttons
                    actions.appendChild(playButton);
                    actions.appendChild(approveButton);
                    actions.appendChild(rejectButton);

                    // Append elements
                    listItem.appendChild(fileInfo);
                    listItem.appendChild(actions);
                    pendingList.appendChild(listItem);
                });
            })
            .catch(error => console.error('Error fetching pending files:', error));

        // Moderate file (approve or reject)
        function moderateFile(file, approved) {
            const fileId = file.match(/\(ID: (.+)\)$/)[1];
            fetch('http://127.0.0.1:8080/music/moderate', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: new URLSearchParams({ fileId, approved })
            }).then(response => {
                if (response.ok) {
                    alert(`File ${approved ? 'approved' : 'rejected'} successfully.`);
                    location.reload(); // Reload list
                } else {
                    alert('Error moderating file.');
                }
            }).catch(error => console.error('Error moderating file:', error));
        }
    </script>
</body>
</html>
